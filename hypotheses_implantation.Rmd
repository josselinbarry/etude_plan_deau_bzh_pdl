---
title: "Analyse des hypotheses sur la répartition des plans d'eau en Bretagne et Pays de la Loire"
author: "Josselin BARRY"
date: "2024-07-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Chargement des packages et des données

```{r}
library(tidyverse)
library(sf)
library(units)
library(mapview)
library(kableExtra)
library(dplyr)
library(png)

source(file = "R/compter_sommer_surfaces_dans_polygone.R")
source(file = "R/afficher_carte.R")

load(file = "data/outputs/w_autres_hypotheses.RData")
```

##  Hypothèses de travail

Ce document vise à tester différentes hypothèses :

- L'implantation des plans d'eau est liée à la  géologie/lithologie.

- L'implantation des plans d'eau est liée au régime hydrologique.

- L'implantation des plans d'eau est liée au type de masse d'eau (densité plus forte en zone côtière et littorale).

- L'implantation des plans d'eau est liée à l'activité de maraichage.

## L'implantation des plans d'eau est-elle liée à la  géologie/lithologie ?

### Répartition des classes lithologiques de la zone d'étude

```{r}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/litho.png'))
```


```{r}
table_litho_densite_pe %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12) 
```

### Densités selon la lithologie simplifiée

Nous avons apparié par jointure spatiale la lithologie simplifiée aux surfaces élémentaires de plans d'eau.

Nous avons ainsi pu étudier la densité numérique de ces plans d'eau selon le type de lithologie simplifiée :

```{r}
densite_numerique_pe_litho
```

Ainsi que la densité surfacique de ces plans d'eau selon la lithologie simplifiée :

```{r}
densite_surfacique_pe_litho
```

La classe lithologique dont les densités sont les plus fortes est le Sable. Toutefois, nous pouvons ici percevoir l'influence des zones de marais, dont le nombre de surfaces élémentaires est très important.

Nous avons donc recalculé ces densités, sans les surfaces élmentaires de plans d'eau situées en zone de marais (densité inter-région, hors marais : 2,64 pe/km²): 

```{r}
densite_numerique_pehm_litho
```

De même pour la densité surfacique :

```{r}
densite_surfacique_pehm_litho
```

Nous pouvons en conclure plusieurs élements : 

- La densité numérique la plus forte (> 3,2 pe/km²) se retrouve avec la classe lithologique Argile. Cette classe lithologique est en effet adaptée par son imperméabilité à l'implantation de plans d'eau. Les soutiens de débit à l'étiage y sont moins importants, soulignant le besoin de stocker l'eau.

- La densité numérique la plus faible (1,9 pe/km²) se retrouve avec la classe lithologique Calcaires, marne et gypse. Cette classe lithologique est en effet peu adaptée par sa perméabilité à l'implantation de plans d'eau. On soulignera également que le soutien des débits des 
cours d’eau est assuré en toutes saisons par les grands aquifères de ces zones (Catalogne et Sauquet, 
2012).

- Les différences sont moins marquées avec les densités surfaciques des surfaces élémentaires de plans d'eau selon les classes lithologiques. On notera toutefois que les classes "Calcaires, marne et gypse", "Ophiolites" et "Sables" rencontrent de nouveau les densités les plus faibles. 
A l'inverse, les classes "Shistes et grès", "Micashistes", "Argiles", "Granites" et "Gneiss" rencontrent les densité surfaciques les plus fortes.

Nous avons ensuite complété cette analyse par l'étude de la surface des plans d'eau en fonction de leur classe lithologique.

### Surface de plan d'eau selon la lithologie

Nous avons écarté ici les mares et les marais pour étudier plus spécifiquement la surface des plans d'eau.

Voici la surface moyenne des plans d'eau en fonction de la lithologie :

```{r}
surface_moyenne_pehm_litho
```

Ainsi que la surface médiane selon la lithologie :

```{r}
surface_mediane_pehm_litho
```

A interpréter ...

### Conclusion 

La densité de plans d'eau n'est effectivement pas la même selon la classe lithologique simplifiée du territoire.

Les argiles notamment rencontrent des densités plus importantes en raison de leurs caractéristiques (imperméabilité et faible soutien à l'étiage).

## L'implantation des plans d'eau est-elle liée aux régimes hydrologiques ?

Nous avons décidé, pour tester cette hypothèse, d'étudier l'influence du ratio "débit d'étiage sur le débit du module". 
Cet indicateur permet en effet de mesurer la vulnérabilité des territoires aux situations d'étiage.  

Nous avons apparié aux plans d'eau les débits moyens QMNA5 et QA, issus des cartes de consensus de l'INRAE.

### Types de régimes hydrologique (ratio q5/qa) de la zone d'étude

```{r}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/ratio_debits.png'))
```

```{r}
table_bv_me_q %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12)
```

### Répartition des plans d'eau selon ce ratio de débit

Voici, la répartition des **plans d'eau ayant pu bénéficier d'un appariement de valeurs de débits**, en fonction de leur ratio Q5/Module (30593 surfaces élémentaires de plans d'eau retenues sur 208593 surfaces élémentaires de plans d'eau totales).

```{r}
repartition_pe_rh
```

En écartant les mares et les marais :

```{r}
repartition_pehm_rh
```

A titre de comparaison, voici la répartition des bassins versants des masses d'eau selon ce même ratio de débit à l'exutoire de la masse d'eau : 

```{r}
repartition_bv_rh
```

### Densité en plans d'eau selon ces classes de ratio de débit :

Nous avons calculé les densités en plans d'eau en fonction de 4 principales classes de ratio de débit : 

```{r}
densite_numerique_pe_rh
```

Comparativement, sans les mares et les marais :

```{r}
densite_numerique_pehm_rh
```

Nous avons également calculé les densité surfaciques :

```{r}
densite_surfacique_pe_rh
```

Et de même sans les mares et les marais : 

```{r}
densite_surfacique_pehm_rh
```

Il apparait très clair à la lecture de ces résultats que le ratio de débit à une influence forte sur la répartition des surfaces élémentaires de plans d'eau.

Les densités numériques et surfaciques sont directement corrélées avec les classes de régime hydrologique : plus le débit d'étiage est faible en proportion du débit de module et plus les densités (numériques et surfaciques) seront importantes.

On retrouve ainsi des densités numériques jusqu'à 3 fois plus importantes dans la classe de ratio d'étiage la plus vulnérable (Débit Qmna5 < 40ème du débit du module) que dans les autres classes.

Ce résultat s'explique par le besoin accru de stocker l'eau dans les territoires où les régimes d'étiage seront sévères par rapport au module.

### Surface de plans d'eau en fonction du ratio de débit

Surface moyenne:
```{r}
surface_moyenne_pe_rh
```

Sans les mares et marais:
```{r}
surface_moyenne_pehm_rh
```

Surface médiane :
```{r}
surface_mediane_pe_rh
```

Sans les mares et marais:
```{r}
surface_mediane_pehm_rh
```

Il est intéressant de noter que la surface médiane d'un plan d'eau répond également à cette logique de besoin de stockage de l'eau en fonction du type de régime hydrologique.

Plus le débit d'étiage est faible en proportion du module, plus la surface médiane des plans d'eau est importante. Cette caractéristique n'est pas observée avec la taille moyenne des plans d'eau.

Cela se confirme en étudiant la taille des plans d'eau selon le régime hydrologique : 

```{r}
surface_pehm_rh
```

### Conclusion

A noter les densités de moindre valeur en raison du plus faible nombre de plans d'eau retenus pour l'analyse.
Plus le débit d'étiage est faible en proportion du module, plus la densité numérique et la surface médiane des plans d'eau sont importantes. 
On relève ainsi sur les portions de territoires les plus vulnérables, des densités numériques jusqu'à trois fois plus importantes et des surfaces médianes 30 à 40% plus importantes comparées à celles des  portions de territoires les moins exposées.
Cela peut s'expliquer par un besoin accru de stocker l'eau en période d'étiage.

## L'implantation des plans d'eau est liée au type de masse d'eau (densité plus forte en zone côtière et littorale) ?

### Type de masses d'eau de la zone d'étude

```{r}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/type_masse_deau.png'))
```


```{r}
table_bv_me_type %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12)
```


### Densités de plans d'eau en fonction du type de masses d'eau

Nous avons ici étudié les densité de plans d'eau en fonction des types de masses d'eau :

```{r}
densite_numerique_pe_type
```

En limitant aux plans d'eau hors mares et marais :

```{r}
densite_numerique_pehm_type
```

En terme de densités surfaciques :

```{r}
densite_surfacique_pe_type
```

Limitées aux plans d'eau hors mares et marais :

```{r}
densite_surfacique_pehm_type
```

On relève ici encore l'influence des secteurs de marais en zone côtière. 
L'analyse de la densité numérique de plans d'eau en fonction du type de masse d'eau, en l'absence des mares et des marais, indique qu'il y a relativement plus de plans d'eau en masses d'eau "Cours d'eau" qu'en masses d'eau "Côtières" ou de transition (30% supplémentaire).   
L'analyse de la densité surfacique est moins révélatrice. Elles sont logiquement plus importantes sur les masses d'eau "Plan d'eau" et du même ordre de grandeur pour les autres type de masses d'eau.

## L'implantation des plans d'eau est-elle liée à l'activité maraichère ?

### Les proportions de maraichage selon les bassins versant des masses d'eau de la zone d'étude

```{r}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/proportion_maraichage.png'))
```

```{r}
table_classes_maraichage %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12)
```

### Les densités de plans d'eau selon la proportion de maraichage

Nous avons extrait du RPG 2022 de la Bretagne les parcelles concernées par une activité maraichère ('FEV', 'PHF', 'AIL', 'ART', 'CAR', 'CEL', 'CHU', 'CCN', 'EPI', 'FRA','LBF', 'MLO', 'NVT', 'OIG', 'RDI', 'POR', 'PVP', 'POT', 'TOM', 'TBT', 'FLA', 'FLP', 'CSS') : Fève, Pois et haricot frais (alimentation humaine), Ail, Artichaut, Carotte, Céleri, Chou, Concombre, cornichon et courgette, Epinard, oseille et bette, Fraise (en pleine terre), Laitue, endive et autres salades, Melon et pastèque, Navet, rutabaga et autres légumes racines (hors carotte, radis, betterave), Oignon et échalote, Radis, Poireau, Poivron, piment et aubergine, Potiron, citrouille et autres courges, Tomate (en pleine terre), Tubercule tropical, Autre légume ou fruit annuel, Autre légume ou fruit pérenne (hors petits fruits à baie), Cultures sous serre hors sol.

### Selon le bassin versant des masses d'eau

Nous avons ainsi pu calculer par masse d'eau la somme des surfaces de ces parcelles orientées vers le maraichage et en déduire la proportion de surface qu'elles représentent sur le bassin versant de la masse d'eau.

Voici, la densité numérique de plans d'eau du bassin versant des masses d'eau en fonction de la proportion de surface en maraichage :

```{r}
maraichage_densite_numerique_tot
```

Et limitée aux plans d'eau hors mares et marais :

```{r}
maraichage_densite_numerique_pehm
```

Il est également possible de regarder les densités relatives de plans d'eau selon des classes de proportion en activité maraichère : 

```{r}
cl_maraichage_densite_numerique_pe
```

En limitant aux plans d'eau hors mares et marais :

```{r}
cl_maraichage_densite_numerique_pehm
```

### Selon les communes

Nous avons réitéré le traitement sur les communes de la zone d'étude, pour en comparer les résultats.

Voici la densité numérique de plans d'eau des communes en fonction de la proportion de surface en maraichage :

```{r}
maraichage_com_densite_numerique_tot
```

Ainsi que la densité numérique de plans d'eau des communes en fonction de la proportion de surface en maraichage :

```{r}
maraichage_com_densite_surfacique_tot
```

Si on exclue des plans d'eau les mares et marais, la répartition des densités numériques est la suivantes :

```{r}
maraichage_com_densite_numerique_pehm
```

La répartition des densités surfaciques :

```{r}
maraichage_com_densite_surfacique_pehm
```

Il est également possible de regarder les densités relatives de plans d'eau selon des classes de proportion en activité maraichère : 

```{r}
cl_maraichage_com_densite_numerique_pe
```

En limitant aux plans d'eau hors mares et marais :

```{r}
cl_maraichage_com_densite_numerique_pehm
```

### Conclusion

Il ne semble  pas y avoir de lien fort entre activité de maraichage et densité numérique de plans d'eau. C'est en effet les masses d'eau dont les proportions de surface en maraîchage sont les plus faibles (dépourvues d'activité de maraichage ou en deça de 1% de leur surface), qui rencontrent les densités les plus fortes.

A noter toutefois, et cela se vérifie avec un découpage plus fin à l'échelle de la commune, qu'à partir de 7 à 8% d'occupation du sol en activité de maraîchage, la densité numérique semble légèrement augmenter avec la proportion de culture.

Pas de tendance visible concernant la densité surfacique, elle ne semble pas liée à l'activité de maraîchage.