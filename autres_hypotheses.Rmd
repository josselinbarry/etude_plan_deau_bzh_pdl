---
title: "Caractéristiques générales et logiques d'implantation des surfaces élémentaires de plans d'eau de la zone d'étude"
author: "Josselin BARRY"
date: "2024-09-23"
always_allow_html: true
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(sf)
library(units)
library(mapview)
library(kableExtra)
library(dplyr)
library(png)

source(file = "R/compter_sommer_surfaces_dans_polygone.R")
source(file = "R/afficher_carte.R")

load(file = "data/outputs/w_autres_hypotheses.RData")
```
## Cractéristiques générales des surfaces en eau de plans d'eau 

### Sur zones humides, sur cours, sur nappe, sur source ...

Voici la répartition des surfaces en eau selon leur lien avec le réseau hydrographique : 

```{r message=FALSE, warning=FALSE}
diagramme_vent
```

```{r message=FALSE, warning=FALSE}
table_tot_pe_alimentation %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12) 
```
### Superficie

A l'échelle de la zone d'étude, la distribution de la superficie des surfaces élémentaires de plans d'eau est la suivante :

```{r message=FALSE, warning=FALSE}
histo_surface_pe
```

### Distance au cours d'eau

```{r message=FALSE, warning=FALSE}
histo_distance_ce_pe
```

### Distance à la source

```{r message=FALSE, warning=FALSE}
histo_distance_source_pe
```

### Ordination de Strahler

```{r message=FALSE, warning=FALSE}
histo_strahler_pe
```

### Proportion du linéaire hydrographique du bassin versant des masses d'eau intercepté par des plans d'eau

```{r message=FALSE, warning=FALSE}
histo_prct_intercept_pe
```

### Classes lithologiques des surfaces élémentaires de plans d'eau

Voici la carte lithologique simplifiée de la zone d'étude ((c)BRGM).

```{r message=FALSE, warning=FALSE}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/litho.png'))
```


```{r message=FALSE, warning=FALSE}
table_litho_densite_pe %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12) 
```

#### Densités selon la lithologie simplifiée

Nous avons apparié par jointure spatiale la lithologie simplifiée aux surfaces élémentaires de plans d'eau.

Nous avons ainsi pu étudier la densité numérique de ces plans d'eau selon le type de lithologie simplifiée :

```{r message=FALSE, warning=FALSE}
densite_numerique_pe_litho
```

Ainsi que la densité surfacique de ces plans d'eau selon la lithologie simplifiée :

```{r message=FALSE, warning=FALSE}
densite_surfacique_pe_litho
```

La classe lithologique dont les densités sont les plus fortes est le Sable. Toutefois, nous pouvons ici percevoir l'influence des zones de marais, dont le nombre de surfaces élémentaires est très important.

Nous avons donc recalculé ces densités, sans les surfaces élémentaires de plans d'eau situées en zone de marais (densité inter-région, hors marais : 2,64 pe/km²): 

```{r message=FALSE, warning=FALSE}
densite_numerique_pehm_litho
```

De même pour la densité surfacique :

```{r message=FALSE, warning=FALSE}
densite_surfacique_pehm_litho
```


### Superficie selon la lithologie

Nous avons écarté ici les mares et les marais pour étudier plus spécifiquement la surface des plans d'eau.

```{r message=FALSE, warning=FALSE}
surface_moyenne_pehm_litho
```

Ainsi que la surface médiane selon la lithologie :

```{r message=FALSE, warning=FALSE}
surface_mediane_pehm_litho
```

## Deux hypothèses autour de l'implantation des plans d'eau

- L'implantation des plans d'eau est-t-elle liée  à la sévérité des étiages ?

- L'implantation des plans d'eau est-t-elle liée au type de masse d'eau (densité plus forte en zone côtière et littorale) ?

### L'implantation des plans d'eau est-elle liée à la "sévérité des étiages" ?

Nous avons décidé, pour tester cette hypothèse, d'étudier l'influence du ratio "débit d'étiage sur le débit du module". 
Cet indicateur permet en effet de mesurer la vulnérabilité des territoires aux situations d'étiage.  

Nous avons apparié aux plans d'eau les débits moyens QMNA5 et QA, issus des cartes de consensus de l'INRAE (https://webgr.inrae.fr/outils/carte-des-debits).

#### "Sévérité des étiages" (ratio q5/qa) de la zone d'étude

```{r message=FALSE, warning=FALSE}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/ratio_debits.png'))
```

```{r message=FALSE, warning=FALSE}
table_bv_me_q %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12)
```

Voici la répartition des bassins versants des masses d'eau et des communes de la zone d'étude en fonction du ratio entre leur plus fort débit d'étiage et leur plus fort débit de module (à l'exutoire pour les masses d'eau) : 

```{r message=FALSE, warning=FALSE}
repartition_bv_rh
```


```{r message=FALSE, warning=FALSE}
repartition_com_rh
```


### Densité en plans d'eau selon ces classes de ratio de débit :

Nous avons calculé, à l'échelle du bassin versant des masses d'eau, les densités en plans d'eau en fonction de 4 principales classes de ratio de débit : 

```{r message=FALSE, warning=FALSE}
densite_numerique_pe_rh
```

Comparativement, sans les mares et les marais :

```{r message=FALSE, warning=FALSE}
densite_numerique_pehm_rh
```

Nous avons également calculé les densité surfaciques :

```{r message=FALSE, warning=FALSE}
densite_surfacique_pe_rh
```

Et de même sans les mares et les marais : 

```{r message=FALSE, warning=FALSE}
densite_surfacique_pehm_rh
```

### Densité numérique en plans d'eau du bassin versant des masses d'eau selon la 'sévérité de leur étiage' : 

Enfin il nous a paru intéressant de regarder la répartition des densités numériques et surfaciques en plans d'eau (hors mares et marais) du bassin-versant des masses d'eau en fonction de la sévérité de leurs étiages : 

```{r message=FALSE, warning=FALSE}
densite_numerique_pehm_rh_bvme_logx
```

```{r message=FALSE, warning=FALSE}
densite_surfacique_pehm_rh_bvme_logx
```

Une analyse statistique de ce lien de corrélation indique cependant (pour les masses d'eau cours d'eau dont la distance de cook est inférieure à 0,01) :

- "p value" = 4,143e-13
- "R² ajusté" = 0,05818

Ce qui indique que ce lien de corrélation est statistiquement très faible.

```{r message=FALSE, warning=FALSE}
summary(mod1)
```

```{r message=FALSE, warning=FALSE}
summary(mod2)
```
#### Répartition des plans d'eau selon ce ratio de débit

Voici la répartition des **plans d'eau ayant pu bénéficier d'un appariement de valeurs de débits**, en fonction de leur ratio Q5/Module (30593 surfaces élémentaires de plans d'eau retenues sur 208593 surfaces élémentaires de plans d'eau totales).

```{r message=FALSE, warning=FALSE}
repartition_pe_rh
```

En écartant les mares et les marais :

```{r message=FALSE, warning=FALSE}
repartition_pehm_rh
```

#### Superficie des surfaces élémentaires de plans d'eau en fonction du ratio de débit

Surface moyenne :

```{r message=FALSE, warning=FALSE}
surface_moyenne_pe_rh
```

Sans les mares et marais :

```{r message=FALSE, warning=FALSE}
surface_moyenne_pehm_rh
```

Surface médiane :

```{r message=FALSE, warning=FALSE}
surface_mediane_pe_rh
```

Sans les mares et marais:

```{r message=FALSE, warning=FALSE}
surface_mediane_pehm_rh
```

### L'implantation des plans d'eau est liée au type de masse d'eau (densité plus forte en zone côtière et littorale) ?

#### Type de masses d'eau de la zone d'étude

```{r message=FALSE, warning=FALSE}
afficher_carte<-function(...){
  imageList<-list(...) ;   totalWidth<-0 ;   maxHeight<-0 ;   
  for (img in imageList){    if(is.character(img)) img<-readPNG(img) ;  dimg<-dim(img) ;  totalWidth<-totalWidth+dimg[2] ;   maxHeight<-max(maxHeight,dimg[1])  }
  par(mar=c(0,0,0,0)) ;   plot(c(0,totalWidth),c(0,maxHeight),type="n",asp=1,xaxt="n",yaxt="n",xlab="x",ylab="y") ;   offset<-0 ; 
  for (img in imageList){    dimg<-dim(img) ;    rasterImage(img,offset,0,offset+dimg[2],dimg[1])
  offset<-offset+dimg[2]  }}

afficher_carte(readPNG('data/cartes/type_masse_deau.png'))
```

Sont écartées de cette hypothèse les masses d'eau plan d'eau.

```{r message=FALSE, warning=FALSE}
table_bv_me_type %>%
  kbl() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), font_size = 12)
```

#### Densités de plans d'eau en fonction du type de masses d'eau

Nous avons ici étudié les densité de plans d'eau en fonction des types de masses d'eau :

```{r message=FALSE, warning=FALSE}
densite_numerique_pe_type
```

En limitant aux plans d'eau hors mares et marais :

```{r message=FALSE, warning=FALSE}
densite_numerique_pehm_type
```

On relève ici encore l'influence des secteurs de marais en zone côtière. 
L'analyse de la densité numérique de plans d'eau en fonction du type de masse d'eau, en l'absence des mares et des marais, indique qu'il y a relativement plus de plans d'eau en masses d'eau "Cours d'eau" qu'en masses d'eau "Côtières" ou de transition.   
